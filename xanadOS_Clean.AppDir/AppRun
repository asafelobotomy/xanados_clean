#!/bin/bash
# AppRun for xanadOS Clean

SELF="$(readlink -f "$0")"
HERE="${SELF%/*}"
export PATH="${HERE}/usr/bin:${PATH}"
export LD_LIBRARY_PATH="${HERE}/usr/lib:${LD_LIBRARY_PATH:-}"

# Set environment variables for the script
export XANADOS_SCRIPT_PATH="${HERE}/usr/share/xanados_clean/xanados_clean.sh"
export XANADOS_GUI_PATH="${HERE}/usr/share/xanados_clean/gui/zenity_gui.sh"

# Check command line arguments
case "${1:-}" in
    --gui|"")
        # Launch GUI mode (default)
        if command -v zenity >/dev/null 2>&1; then
            exec "${HERE}/usr/share/xanados_clean/gui/zenity_gui.sh" "${@:2}"
        else
            zenity --error \
                --title="Missing Dependency" \
                --text="Zenity is required for the GUI but is not installed.

Please install zenity:
sudo pacman -S zenity

Or run in CLI mode:
$0 --cli" 2>/dev/null || \
            echo "Error: Zenity is required for GUI mode. Install with: sudo pacman -S zenity"
            exit 1
        fi
        ;;
    --cli)
        # CLI mode
        exec "${HERE}/usr/share/xanados_clean/xanados_clean.sh" "${@:2}"
        ;;
    --help|-h)
        # Show help for both modes
        echo "xanadOS Clean v2.0.0 - Professional Arch Linux system maintenance"
        echo ""
        echo "USAGE:"
        echo "  $0                    Launch GUI (default)"
        echo "  $0 --gui             Launch GUI explicitly"  
        echo "  $0 --cli [OPTIONS]   Launch CLI mode"
        echo ""
        echo "GUI MODE:"
        echo "  Interactive dialogs for easy system maintenance"
        echo "  Native system integration with Zenity"
        echo ""
        echo "CLI MODE OPTIONS:"
        "${HERE}/usr/share/xanados_clean/xanados_clean.sh" --help | tail -n +3
        ;;
    *)
        # Pass all other arguments to CLI
        exec "${HERE}/usr/share/xanados_clean/xanados_clean.sh" "$@"
        ;;
esac
